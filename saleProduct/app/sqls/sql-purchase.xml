<?xml version="1.0" encoding="UTF-8"?>
<properties>
    <entry key="sql_">
    </entry>
    
    <!--
    	TODO:
    	outAemricanArea: 1
    	inAemricanArea : 0
    	
    	当空时设置：
    	itemContidtionNull:1
    	
    	fulfillmentChannelNull:1
    	
    	isPriceQuery:1
    	isQuantityQuery:1
    	
    	pm:other ==>0
    	
    	uncategory：1
    	
    	$VIEW_PP$ :数据权限
    -->
   
   <entry key="sql_purchase_plan_list">
      SELECT  sc_purchase_plan.* ,
				( select sc_user.name from sc_user where sc_user.login_id = sc_purchase_plan.creator ) as USERNAME,
				( select sc_user.name from sc_user where sc_user.login_id = sc_purchase_plan.executor ) as EXECUTOR_NAME,
				( select count(*) from sc_purchase_plan_details where sc_purchase_plan_details.plan_id = sc_purchase_plan.id
						and ( sc_purchase_plan_details.status = 1 or sc_purchase_plan_details.status is null ) ) as STATUS1,
				( select count(*) from sc_purchase_plan_details where sc_purchase_plan_details.plan_id = sc_purchase_plan.id
						and  sc_purchase_plan_details.status = 2  ) as STATUS2,
				( select count(*) from sc_purchase_plan_details where sc_purchase_plan_details.plan_id = sc_purchase_plan.id
						and sc_purchase_plan_details.status = 3 ) as STATUS3,
				( select count(*) from sc_purchase_plan_details where sc_purchase_plan_details.plan_id = sc_purchase_plan.id
						and sc_purchase_plan_details.status = 4 ) as STATUS4,
				( select count(*) from sc_purchase_plan_details where sc_purchase_plan_details.plan_id = sc_purchase_plan.id
						and sc_purchase_plan_details.status = 5 ) as STATUS5
               FROM sc_purchase_plan 
               where 1=1
        {@ #$VIEW_PP# }
		{@ and  name = '#name#' }
		{@ and  type = '#type#' }
		and status = 1
         order by sc_purchase_plan.create_time desc
   </entry>
   
    <!-- 采购执行列表 -->
      <entry key="sql_purchase_plan_list_executor">
      SELECT  sc_purchase_plan.* ,
				( select sc_user.name from sc_user where sc_user.login_id = sc_purchase_plan.creator ) as USERNAME,
				( select sc_user.name from sc_user where sc_user.login_id = sc_purchase_plan.executor ) as EXECUTOR_NAME,
				( select count(*) from sc_purchase_plan_details where sc_purchase_plan_details.plan_id = sc_purchase_plan.id
						and ( sc_purchase_plan_details.status = 1 or sc_purchase_plan_details.status is null ) ) as STATUS1,
				( select count(*) from sc_purchase_plan_details where sc_purchase_plan_details.plan_id = sc_purchase_plan.id
						and  sc_purchase_plan_details.status = 2  ) as STATUS2,
				( select count(*) from sc_purchase_plan_details where sc_purchase_plan_details.plan_id = sc_purchase_plan.id
						and sc_purchase_plan_details.status = 3 ) as STATUS3,
				( select count(*) from sc_purchase_plan_details where sc_purchase_plan_details.plan_id = sc_purchase_plan.id
						and sc_purchase_plan_details.status = 4 ) as STATUS4,
				( select count(*) from sc_purchase_plan_details where sc_purchase_plan_details.plan_id = sc_purchase_plan.id
						and sc_purchase_plan_details.status = 5 ) as STATUS5
               FROM sc_purchase_plan 
               where 1=1
		{@ and executor = '#executor#' }
		{@ and name = '#name#' }
		{@ and type = '#type#' }
		and status = 1
         order by create_time desc
   </entry>
   
   <entry key="sql_purchase_plan_details_list">
          SELECT distinct  sc_purchase_plan_details.* ,
				 sc_product.TITLE , sc_product_flow_details.DAY_PAGEVIEWS ,
                (SELECT sc_supplier.name FROM sc_supplier WHERE sc_supplier.id = sc_purchase_plan_details.PROVIDOR ) AS PROVIDOR_NAME,
				(SELECT spi.local_url FROM sc_product_imgs spi WHERE spi.asin = sc_product.asin LIMIT 0,1 ) AS LOCAL_URL,
				( SELECT TOTAL_COST - PURCHASE_COST
				FROM sc_product_cost 
				WHERE sc_product_cost.asin = sc_product.asin AND
					( sc_product_cost.type='FBM' OR sc_product_cost.type IS NULL )  ) AS FBM_COST,
					
				( SELECT MIN(sc_sale_competition_details.seller_price+sc_sale_competition_details.seller_ship_price) FROM sc_sale_competition_details
						WHERE sc_sale_competition_details.asin = sc_product.asin
						and ( type like 'F%' or type like 'N%' )
						 ) AS FBM_PRICE,
						
				( SELECT MIN(sc_sale_fba_details.seller_price) FROM sc_sale_fba_details
						WHERE sc_sale_fba_details.asin = sc_product.asin ) AS FBA_PRICE,
				( SELECT TOTAL_COST - PURCHASE_COST
				FROM sc_product_cost WHERE sc_product_cost.asin = sc_product.asin AND
					( sc_product_cost.type='FBA' OR sc_product_cost.type IS NULL )  ) AS FBA_COST,
				(SELECT COUNT(*) FROM sc_product_supplier WHERE sc_product_supplier.asin = sc_product.asin
							AND sc_product_supplier.num1 IS NOT NULL AND  sc_product_supplier.offer1 IS NOT NULL  ) AS XJ 
               FROM sc_purchase_plan_details , sc_product
				LEFT JOIN sc_product_flow_details ON sc_product_flow_details.asin = sc_product.asin
				LEFT JOIN sc_sale_competition_details  ON sc_sale_competition_details.asin = sc_product.asin
			where 1=1 and  sc_purchase_plan_details.asin = sc_product.asin
			{@  and sc_purchase_plan_details.plan_id = '#planId#' }
			{@  and ( sc_purchase_plan_details.status = '#status1#' or sc_purchase_plan_details.status is null ) }
			{@  and sc_purchase_plan_details.status = '#status#' }
			
   </entry>
   
    <entry key="sql_update_sc_purchase_plan_details">
        update sc_purchase_plan_details 
        	set plan_num = '{@#plan_num#}',
				quote_price = '{@#quote_price#}',
				providor = '{@#providor#}',
				sample = '{@#sample#}',
				area = '{@#area#}',
				sample_code = '{@#sample_code#}',
				memo = '{@#memo#}'
				where id = '{@#id#}'
   </entry>
   
   <entry key="sql_marketing_test_list">
         SELECT  sc_marketing_test.* ,
				( select sc_user.name from sc_user where sc_user.login_id = sc_marketing_test.creator ) as USERNAME
               FROM sc_marketing_test 
               where 1=1
                 order by sc_marketing_test.create_time desc
   </entry>
   
   <entry key="sql_marketing_test_details_list">
         SELECT  sc_marketing_test_details.* ,
				 sc_product.TITLE , sc_product_flow_details.DAY_PAGEVIEWS ,
                (select sc_supplier.name from sc_supplier where sc_supplier.id = sc_marketing_test_details.PROVIDOR ) as PROVIDOR_NAME,
				(SELECT spi.local_url FROM sc_product_imgs spi WHERE spi.asin = sc_product.asin LIMIT 0,1 ) AS LOCAL_URL,
				sc_sale_competition.FM_NUM,sc_sale_competition.NM_NUM,sc_sale_competition.UM_NUM,sc_sale_competition.TARGET_PRICE
               FROM sc_marketing_test_details , sc_product
			LEFT JOIN sc_sale_competition  ON sc_sale_competition.asin = sc_product.asin
			left join sc_product_flow_details on sc_product_flow_details.asin = sc_product.asin 
			where 1 = 1 and  sc_marketing_test_details.asin = sc_product.asin 
			{@ and sc_marketing_test_details.plan_id = '#planId#' }
   </entry>
   
   <entry key="sql_purchase_delete_list">
		SELECT  sc_purchase_plan_details_delete.* ,
				 sc_product.TITLE , sc_product_flow_details.DAY_PAGEVIEWS ,
                (SELECT spi.local_url FROM sc_product_imgs spi WHERE spi.asin = sc_product.asin LIMIT 0,1 ) AS LOCAL_URL,
				( SELECT
					TOTAL_COST - PURCHASE_COST
				from sc_product_cost where sc_product_cost.asin = sc_product.asin limit 0,1 ) as P_COST,
				sc_sale_competition.TARGET_PRICE as TARGET_PRICE,
				(select name from sc_user where sc_user.login_id =sc_purchase_plan_details_delete.creator ) as CREATOR_NAME,
				(select name from sc_user where sc_user.login_id =sc_purchase_plan_details_delete.deletor ) as DELETOR_NAME,
				(select name from sc_purchase_plan where sc_purchase_plan.id =sc_purchase_plan_details_delete.plan_id ) as PLAN_NAME
               FROM sc_purchase_plan_details_delete , sc_product
			   left join sc_product_flow_details on sc_product_flow_details.asin = sc_product.asin
				LEFT JOIN sc_sale_competition  ON sc_sale_competition.asin = sc_product.asin
			where 1 = 1  and sc_purchase_plan_details_delete.asin = sc_product.asin 
        order by sc_purchase_plan_details_delete.DELETE_TIME desc
   </entry>
   
</properties>